# Introduction

My thesis is concerned with the building and comparison of various computer models which attempt to make predictions of the electricity demand of residential hot water cylinders.
After stating this to people, reactions generally range from polite "oh, OK"s, to the more honest "why would you want to do that?". This is a justified reaction to those unfamiliar with the topic.
The answer, in a nutshell, is "to increase efficiencies".
I use the plural "efficiencies", as these are twofold.
When a resource must be readily available in a particular quantity at all times, while only a fraction of it is being utilised for most of these times, we tend to see inefficiencies. 
Having a large tank of water being maintained at 65Â°C day and night, while only a portion of it is being used at particular times of day or week for the vast majority or the time, is thermally inefficient.
Having an electricity grid being built and maintained to generate and transmit enough electricity to cover periods of extremely high demand, while only a portion of this capacity is being used for the vast majority of the time, is economically inefficient.

This chapter explains these two inefficiencies in more detail and outlines the role that smarter control of hot water cylinders may play in alleviating these inefficiencies, while hopefully demonstrating the value predictive modelling would bring to such a smart control system.
<!--
Problem: One solution to the variability of electricity demand and supply problems is DSM, but current methods not sophisticated
New approach: The growing field of data science along with the availability of electricity data and methods of analysing it could be used to help with more effective DSM
My thesis: (ii) Explores a variety of models to forecast hot water demand; (ii) Evaluates the appropriateness of a selection of these models against one another using various metrics
-->

```{r loadFiles1, include=FALSE}
filepathsPath <- dirname(getwd())
#filepathsPath <- getwd()
source(paste0(filepathsPath, "/filepaths.R"))

#dFolder <- "~/HWCanalysis/Masters/data/"   # Data folder
#pFolder <- "/home/parra358/HWCanalysis/Masters/plots/"  # Plots folder (laTeX did not like '~' notation)
```

## Supply must match demand

Temporal variation in electricity demand occurs at a variety of timescales in an electricity grid. 
Throughout summer months, in hot and dry climates, electricity demand on average increases due to the increased use of air conditioners and irrigation systems.
Throughout winter months, in cooler climates, electricity demand on average increases due to increased use of electric heaters.
These average increases are more pronouned at certain times of day, generally reflected as two 'peaks' in the morning and evening, due to the effects of residential electricity demand.
As electrical energy cannot be stored, electricity supply must match this fluctuating demand.
The challenges associated with supplying electricity in order to effectively meet demand are likely to be exacerbated by the predicted increase of renewable energy in the grid, as renewable energy generation is often reliant on weather conditions, and consequently can not easily be shifted to meet demand[@Lund2015]. 
Failure to match supply and demand may result in grid black-outs, as well as large-scale damage to electricity-using appliances that operate under specific alternating current (AC) frequencies.
New Zealand's electricity system frequency must be maintained at or near 50 Hz. In general, when more electricity is generated than is being consumed the AC frequency increases, and when more electricity is being consumed than is generated the AC frequency drops.
In the event of a large generator unexpectedly going offline, a high voltage direct current (HVDC) pole tripping, or other large disruptions to supply there must be reserve electricity available so that the frequency is maintained within an acceptable range (between 48 and 52 Hz).
Ensuring that there is enough capacity to provide electricity at times of very high demand or during unexpected grid emergencies requires the building and maintenance of generation and transmission infrastructure that sits underutilised for the majority of the time. This a very costly and inefficient situation[@Strbac2008]. 

## ...Except when demand can match supply

There are currently a range of mechanisms in place to ensure that the supply of electricity balances with the varying demand[@Strbac2008], and that currents do not exceed transmission and distribution infrastructure constraints[@TranspowerNZ2015].
One method to deal with the imbalance between the supply and demand of electricity is to adjust demand to meet supply. This is referred to as demand side management (DSM). 
The grid benefits in being able to rapidly decrease load is reflected by the ability to monetize this capacity through various electricity markets.

### Instantaneous reserves

The 'instantaneous reserves' (IR) markets are national markets concerned with stabilising the grid alternating current (AC) frequency during times of severe demand peaks or grid emergencies [@EANZ2014].
The systems operator will pay a premium for any electricity available to be generated during these periods (know as generating capacity), or load able to be shed during these periods (known as interruptible load).
There are two distinct markets covering these periods. Fast instantaneous reserve (FIR) is for electricity that can be produced (or load that can be shed) within 1 second and continue being produced (or remain reduced) for 60 seconds. Sustained instantaneous reserve (SIR) is for electricity that can be produced (or load that can be shed) within 60 seconds and continue being produced (or remain reduced) until instructed otherwise by the systems operator. 
Electricity generators that are running under capacity, and electricity consumers with a large enough reducible load, may sell their ability to increase supply or decrease demand in half-hour ahead markets.
These actors are then paid for providing this service, regardless of whether or not they were required to perform it.

### Congestion periods

Congestion period demand charges are another market-based mechanism for smoothing electricity loads. 
Large electricity users are often provided a discounted kWh price of electricity, while being charged high penalties for any electricity consumed during times where there is extreme local network demand (known as 'congestion periods')[@Orion2017]. Once again, this provides market value to the ability to shift electricity demand in time.

### Ripple control

Another DSM mechanism is that of ripple control. 
Ripple control is a DSM mechanism that has been utilised in New Zealand since the 1950's.
Under a ripple controlled system, electricity distribution networks provide a discounted electricity rate in order to be able to remotely cease the supply of electricity during peak periods or grid emergencies[@Orion2017]. 
This is achieved through sending high frequency signals though the electricity lines to be interpreted by specialised receivers that then suppress the operation of the appliance they are connected to (usually hot water cylinders or irrigation systems).
While this system as it currently operates is highly beneficial to the grid, it has been operating essentially unchanged since its introduction, and there is significant room for improvement utilising more recent technology[@Jack].

### Spot markets

An additional mechanism for matching supply and demand is that of spot market electricity pricing.
The New Zealand electricity grid is composed of over 200 points at which electricity may enter or exit. These are referred to as the grid 'nodes'. 
Electricity generators bid for the right to provide electricity to cover the predicted demand of each grid node over the next half-hour[@ElectricityAuthority2011]. 
Price variation occurs according to supply and demand. Prices rise when there is high electricity demand on the grid or there is limited availability of electricity resources with low marginal cost of production, such as those from renewable sources. Conversely, prices fall when electricity is cheap to produce, or total electricity demand is low. 
Spot market electricity prices fluctuate wildly, with the Benmore node BEN2201 having prices ranging from \$0.02/MWh to \$894.38/MWh during 2017 for example.
Electricity retailers purchase electricity from the generators on this spot market, and sell it to consumers. 
While some larger commercial and industrial electricity consumers are exposed to spot market pricing and may adjust their consumption accordingly, residential electricity consumers are usually charged a fixed price per kWh, with the price variability being 'bundled in' by the retailer.
There have been proposals[@NewZealandElectricityCommission2009] that a market-based tactic to reduce grid peaks would be to encourage residential consumers to move to a real-time pricing plan that uses smart meters to send price signals in order to disincentivise peak-time electricity usage. 
Electricity company Flick in New Zealand is already providing this, offering customers with compatible smart-meters the spot-market electricity price (with additional base costs). An app that displays the current spot price is provided to customers, with the intention being that consumers attempt to reduce demand during times of comparatively high prices.
While this method of 'deliberate' demand response is well intentioned, studies of consumer response to changes in electricity price indicate that prices generally have little effect on consumption patterns when relying on consumers to deliberately alter their electricity consumption[@Lawson2011a; @Okajima2013; @Filippini2011].
One solution to this is to automate the scheduling of appliances in order to take advantage of price differentials. 

### Smart control

With the rapid rise of 'internet of things' technology, whereby devices are interconnected and offer the ability to be controlled remotely, there is the ability to automatically schedule flexible devices in order to minimise operations costs or more effectively utilise renewable electricity sources.

Many electricity using devices can have their use times shifted on a daily scale with limited impact to the end user (a property referred to as 'flexibility'). Devices such as washing machines and dishwashers exhibit this property, along with battery storage systems in the form of electric cars and bicycles, and some thermostatically controlled appliances such as the focus of this thesis, electric hot water cylinders (HWCs). Flexible devices are obvious candidates for autonomous control objectives, as they have significant potential to temporally shift their demand (for example into times where electricity is cheaper) with minimal impact to the end user.

<!--Smart control of demand-flexible appliances is part of a new paradigm in electricity distribution known as the Smart Grid. The Smart Grid is a power grid where energy producers, network companies and consumers are intelligently connected to each other. On the consumer side this largely enabled by advanced electricity meters, known as âsmart metersâ, which have the ability to store, display and transmit data associated with the electricity being consumed. This two-way information communication is proposed to encourage the integration of distributed (generally renewable) power generation, and allow sophisticated metering and automation to proliferate\cite{Lund2015}. Due to the high flexibility of various residential appliances, this technology could thus enable significant load-levelling\cite{Dhulst2015}.
-->

## Predicting electricity demand

The ability to predict usage patterns allows devices to be controlled according to the usage patterns of individual houses. This is beneficial for demand side management objectives as it would provide additional capacity for control while reducing negative effects on service[@Gelazanskas2015]. It may also provide the means to participate in half-hour ahead demand response markets by providing the ability to bid an estimated capacity for load-shedding according to forecasted reducible demand. 
In addition, scheduling thermal appliances such as hot water cylinders to fit forecasted demand patterns can facilitate improvements in energy efficiency[@Denis2019].

With the roll-out of smart meters in New Zealand, there is now the ability to collect and process essentially 'real-time' data on hot water electricity consumption for individual consumers. 
This would allow ripple control (or a similar system) to be personalised to individual household usage patterns, providing the ability to suppress the element operation more or less frequently according to whether the household had low or high hot water consumption, respectively.

### Hot water cylinders for demand response

Residential electricity demand is a key contributor to network demand peaks.
In New Zealand, it is estimated that residential electricity usage contributes around half of peak demand[@ElectricityCommission2007] and residential hot water use is around 30% of residential energy used[@Pollard2002]. 
A study by the Household Energy End Use Project (HEEP) showed that hot water usage makes up to 36% of residential peak demand[@Pollard2002], with other research suggesting it may be up to 50%[@Jack]. 
In New Zealand, electric hot water cylinders (HWCs) are very common, with 91% of households having electricity as an energy source for water heating[@Pollard2002]. 
Due to their ability to store large amounts of energy in the form of heat, hot water cylinders are generally the most âflexibleâ appliances in New Zealand households[@Stephenson2017], rendering them perfect candidates for demand shifting.
While control of hot water cylinders for DSM objectives is possible without demand forecasting, the ability to accurately predict future demand allows more finely-tuned control that may be catered to the use patterns of individual households, allowing a far greater range of control without negative effects to the end-user[@Lomet2015].
In addition, the ability to predict (with reasonable accuracy) the electricity load for the next half hour of a significant number of hot water cylinders would provide the ability for companies which have the ability to remote control these HWCs (known as an "aggregator service") to submit bids into the instantaneous reserves markets.

## Increasing thermal efficiency

In addition to assisting DSM objectives, personalised control of hot water cylinders can improve their efficiency by only heating as much water as is required by the household. 
Hot water cylinders under normal usage conditions have a tendency to 'stratify' their contents into distinct bodies of water, namely a hot upper layer of water and a cool lower layer of water, separated by a thin thermocline[@JackDew2018].
The household residents may use hot water with no noticeable changes in temperature until the hotter top layer suddenly runs out, causing the unpleasant 'cold water event', familiar to many who have lived in a household with heavy hot water use.
For those households with moderate to low hot water demand however, their hot water cylinder may be keeping a far greater amount of water hot than they would expect to use.
As no insulation is perfect, any object that is hotter than its surroundings will suffer from heat loss, with the amount of heat lost being proportional to the difference in temperature between the body and the surroundings. 
Thus, as hot water loses heat energy to the environment faster than cooler water, storing hot water in excess of what is required is inefficient. 
Simulations by Denis, Suard, Lomet and ChÃ¨ze[@Denis2019] demonstrated average energy savings of up to 10% in hot water systems that only heated according to what was required.
The ability to store only as much hot water as will be required by the household (with the remainder of the tank being left as cooler water) therefore has the potential to reduce total hot water electricity consumption[@Denis2019]. 

## Forecasting from time series data

Time series data is that which involves measurements of variables sequentially or at fixed intervals of time[@Cowpertwait2009].
This data may then be processed, analysed and extrapolated in a manner that produces predictions of future events or occurrences, a process known as 'forecasting'. 
There are number of different methods of forecasting time series data.
Although the distinction is subtle, these methods may be broadly separated into two categories; (i) conventional, and (ii) artificial intelligence (AI)[@MatDaut2017].
In the context of electricity demand, forecasting may also be broadly classified by the length of time into the future the demand (or 'load') forecast is predicting[@Ahmad2014]. Short term load forecasting (STLF) is usually used to refer to predictions of less than 24 hours, although it can refer to forecast periods of up to one week. Medium term load forecasting (MTLF) refers to predictions between one week and one year. Long term load forecasting (LTLF) is for predictions spanning longer than one year.

### Conventional forecasting methods

Conventional methods may be separated into two distinct techniques.
The first, referred to as _causal_ modelling[@Hong2016], utilises data of separate but related (explanatory[^1]) variables and makes predictions based on basic statistical relationships between them. Regression analysis is a causal model commonly used in electricity forecasting, and may be understood as follows:
If there is the ability to know (or sufficiently accurately predict) the value(s) of the independent variable(s) at a particular future time, then a forecast for the dependent variable may be calculated at that same time based on the causal relationship between them.
In the context of electricity demand forecasting, relevant predictable independent variables may be social factors such as public holidays, or (accurately forecasted) weather conditions[@Wei2018].
However if there is no obtainable value(s) for the independent variable(s) at the future time for which a prediction is required, more subtle techniques must be employed. 
One option is to establish a relationship between the value(s) of the independent variables and the following values of the dependent variable. In the context of DHW electricity demand forecasting, this may be the relationship between the electricity demand of other appliances, and subsequent values of DHW electricity demand.

Another conventional forecasting method known as _time series analysis_ utilises the fundamental properties of only the time series data of the variable being predicted.
On important technique used in time series analysis is the separation of the data into individual components, namely trend, cycles and 'noise'. 
In the context of DHW electricity time series data, the trend would be a gradual increase (or decrease) in average hot water use over long periods of time, the cycles would be average daily use patterns such as morning and evening peaks previously mentioned, and the noise is any deviation of the data from the trend and cycle components (people not actually using hot water according to strict mathematical relationships).
Additionally, forecasts may be made by understanding the relationships between a variable and its previous values. Autoregression (AR) and moving average (MA) are two commonly utilised techniques to obtain these relationships. In the context of DHW forecasting this method may be best interpreted as an understanding of the lengths of time a water heater element will typically remain on (or off) for. 

Conventional forecasting techniques are generally prized for being simple and interpretable, while taking minimal computing resources, but often require significant human input and are often outperformed in regards to accuracy by more advanced methods, such as artificial intelligence.

[^1]: Multivariate data can be thought to be made up of both dependent and independent (or 'explanatory') variables. Broadly speaking, dependent variables are those we are interested in measuring or predicting (in this research, hot water electricity demand). Explanatory variables are those we expect to impact our dependent variables (in this research we use time and the electricity demand of other appliances).

### AI forecasting methods

```{r ANNinDF, out.width='100%', include=FALSE, fig.cap="Documents in SCOPUS containing keywords: artificial neural network electricity demand forecasting"}
knitr::include_graphics(paste0(pFolder, "artificial_neural_network_electricity_demand_forecasting.png"))
```


Artificial Intelligence (AI) methods are those that use more complex techniques from the field of machine learning for forecasting.
These methods can be considered separate from their conventional counterparts by their ability to process and establish relationships between data in a more autonomous fashion. 
In general, AI methods are constructed more autonomously than than conventional forecasting methods, allowing minimal human input to obtain (often) highly accurate predictions.
This comes with a trade-off however, as their outputs tend to be 'black box', generally providing less in the way of understanding underlying processes than many conventional methods obtained through utilising human intuition and statistics.
In addition, AI modelling can be hindered by the large amounts of computing resources necessary.

Two commonly used AI techniques in the field of electricity demand forecasting are those of artificial neural networks (ANN) and support vector machines (SVM).
ANNs attempt to mimic biological learning mechanisms by processing a set of training data through clusters of artificial neurons, each of which individually receive (numerical) inputs, assign them certain weights, and then output the weighted value into other artificial neurons, which perform the same task, until eventually producing a final output.
The weights assigned by each neuron are then iteratively adjusted in order to minimise the error of the final output.
Support vector machines classify data points by mapping them in hyperspace and distinguishing between them according to which side of a hyperplane they fall on, with the position of the classifying hyperplanes being constructed iteratively in order to maximise the perpendicular distance between each hyperplane and the closest samples on either side of it (refer to Figure \@ref(fig:SVMexample) for a linear example). 


```{r SVMexample, out.width='100%', fig.cap="Example demonstrating the classifying mechanism of a SVM. Image by Larhmam - Own work, CC BY-SA 4.0, https://commons.wikimedia.org/w/index.php?curid=73710028"}
knitr::include_graphics(paste0(pFolder, "SVMmargin.png"))
```

Non-linear partitions can also be constructed using a kernel function. 

<!--
_Perhaps for these reasons, research interest of SVMs in the context of electricity demand forecasting is still growing, as can be seen in Figure \@ref(fig:SVMinDF). remove?_
-->

```{r SVMinDF, include=FALSE, out.width='100%', fig.cap="Documents in SCOPUS containing keywords: support vector network electricity demand forecasting"}
# latex does NOT like this image for some reason. Either grab again or remove all reference.
knitr::include_graphics(paste0(pFolder, "SVelecDemandForecasting.png"))
```


## Literature review

The literature relevant to this thesis may best be considered as falling somewhere within three separate but overlapping categories: hot water cylinder modelling, demand forecasting, and smart control of appliances.
Hot water cylinder modelling refers to the process of building computer models that represent a hot water cylinder and its operation.
While all models are less accurate than the systems they replicate, analyses that utilise computer models have a number of crucial benefits over real-world alternatives. 
Firstly, a well-constructed computer model provides the ability to make an analysis regarding alterations to the physical system that may be difficult or expensive to carry out in reality. 
Secondly, computer models provide the ability to âspeed upâ the passing of time, and to be run âinto the futureâ, two features currently unavailable when conducting real-world analysis. 

Generally speaking, a hot water cylinder model will consist of two components.
First, a mathematical representation of the physical cylinder itself. At a minimum, this must take into consideration the inflows of cold and outflows of hot water, heat input into the cylinder from the element, and heat loss from the walls of the cylinder.
Water temperature(s) within the cylinder are important, both for heat flow calculations, and for determining if and when the cylinder has run out of hot water.
In a cylinder of warm water at equilibrium a temperature difference between the top and bottom of the cylinder naturally arises. This can be described in terms of three distinct volumes of water. At the bottom of the cylinder, there is a volume of cooler water, with only a slight change in temperature from the bottom to the top of it. At the top, a volume of warmer water, again with only a slight vertical temperature gradient.
These are separated by a volume of water known as the thermocline, whereby a rapid change in temperature occurs between its top and bottom[@JackDew2018].
Some models choose to simplify this heat distribution within the tank, considering it instead to be one well-mixed, single temperature volume of water[@Heleno2015; @Parra2016; @Roux2017]. This method has the benefit of being computationally inexpensive, allowing for temporally extensive analyses to be carried out, to the detriment of some physical accuracy.
Other models simplify the heat distribution as two well-mixed bodies of water at the top and bottom, separated by a thermocline of negligible width[@JackDew2018; @Booysen2017; @Nel2018].
While requiring more computer resources than the single-volume models, the two-volume models also provide relatively computationally inexpensive means of analysing hot water usage, while capturing some additional physical characteristics such as the rapid ârunning outâ of hot water.
Finally, some hot water cylinder models use computational fluid dynamics (CFD) software to maintain very high amounts of physical accuracy, essentially allowing the determination of water temperature at any point within the cylinder[@Kong2016; @Yaici2013]. 

### Smart control literature

Hot water cylinder models may then be utilised for a number of applications.
The high accuracy CFD models are great for providing accurate estimates as to the effects of making physical changes to the system, such as adjusting the position of the outlet[@Kong2016; @Yaici2013] or cylinder dimensions [@Yaici2013].
The more physically simplistic models are more suitable for analyses that span over long periods of time.
One such analysis a hot water cylinder model may be used for is as a simulation to analyse the impacts of smart control scenarios.
These scenarios generally involve simulating the suppression of the element or adjustment of thermostat at key times to reduce grid peaks[@Roux2018; @Sepulveda2010, @Kepplinger2015], provide grid-beneficial (instantaneous response) services[@Kondoh2011], minimise costs under time-varying electricity prices[@Kepplinger2015; @Mohsenian-Rad2010; @OShaughnessy2018; @Sepulveda2010; @Cui2016; @Kapsalis2018], utilise low-carbon electricity[@Ramchurn2012], and minimise âcold water eventsâ under a budget constraint[@Yu2013].
Insulated hot water cylinders show high flexibility, and as such are good candidates for smart control, but similar objectives can be obtained with other thermal devices such as heating and air conditioning systems[@OShaughnessy2018; @Yu2013], as well as other devices such as electric vehicles and washing machines[@Cui2016; @Mohsenian-Rad2010].
In order to effectively schedule appliances under smart control, reasonable estimates must be made as to when they are required to be utilised. An electric vehicle, for example, must be sufficiently charged before the next drive, and a hot water cylinder must be sufficiently hot before the next shower. Accurate predictions of these 'next' usage events provide a smart control system the ability to fine tune their optimisation algorithms to take full advantage of the demand flexibility without negatively impacting the end user.
As such, demand forecasting in some form is common in smart control literature[@Cui2016; @Roux2018; @Kepplinger2015; @Ramchurn2012; @Sepulveda2010; @Yu2013; @Kapsalis2018].

Ramchurn, Vytelingum, Rogers and Jennings[@Ramchurn2012] model households with generic storage capacity under a homeostatic control mechanism which uses linear optimisation to minimise consumption of high-carbon electricity by shifting electricity use over daily timescales in order to match predicted renewable energy availability. Reduction in residential carbon emissions of up to 25% were demonstrated, as were consumer savings of up to 14.5% under a carbon-based pricing mechanism. 

Electricity demand forecasting itself is a large and active research area. 
While much research is conducted relating to predicting grid-level[@DeFelice2013; @Jain2009], substation level[@Goude2014], or building level[@Popescu2016; @Gajowniczek2014; @Ahmad2014, @McLoughlin2013] demand, some has been done on predicting the demand of individual household appliances [@Arghira2012], including that of hot water cylinders[@Gelazanskas2015; @Lomet2015; @Aki2016; @Denis2019].

Hot water electricity demand forecasts are examples of a different type of model the the physical hot water models mentioned at the beginning of this section. Rather than being concerned with replicating physical characteristics of hot water demand, these models focus only on understanding mathematical relationships within existing data. This is acheived by algorithmically 'fitting' themselves to existing data, in order to best replicate under certain constraints. Once this is acheived, these models may then be projected forward in time to where no data exists in order to provide forecasts.

Improve thermal efficiency with forecasting([@Denis2019]) without forecasting as such, only 'patterns?(@Roux2018)


## Aims

The aim of this project is use electricity demand data from New Zealand households to develop an efficient, accurate, and physically meaningful method of predicting individual household hot water electricity demand at 30 minute resolution.

<!--
The aims of this project are twofold.
First, based on existing literature and preliminary modelling, a selection of models will be chosen as good candidates for forecasting residential hot water electricity demand utilising data that would be accessible from smart meters with separately metered hot water, as is commonly encountered in New Zealand.
Secondly, the selected models will be fitted to historical electricity data and compared with one another in more detail, using both quantitative and qualitative metrics. 
It is an exploratory analysis with high regard given to reproducibility under the assumption that further analysis may follow on from it, although an attempt is made to arrive at an 'ideal' model.
-->

## Thesis structure

The main body of analysis is broadly broken into three sections. 
Chapter \@ref(methodology) introduces the electricity demand data utilised in this work, explains the data cleaning and preparatory process, and then provides a broad overview of various relevant patterns and attributes of the data. It goes on to introduce the models utilised in the context of electricity demand, and describe the metrics by which the models are compared to one another.
Chapter \@ref(results) demonstrates the effectiveness of a number of statistical models to forecast hot water electricity demand of each household using half-hour averaged data. This is currently the form which is stored and transmitted by smart meters in New Zealand currently. 
Each forecasting model used is then compared to one another by a number or relevant metrics. These comparative results are provided in the Conclusion (Chapter \@ref(conclusion)). Potential further work is also detailed in this section.

Relevant tables, including model parameters and some data attributes are provided in the appendix.

